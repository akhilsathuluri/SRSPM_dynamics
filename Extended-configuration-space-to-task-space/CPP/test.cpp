#include<iostream>
#include<Eigen/Dense>
#include "dyn_funcs_test.h"

#define coords 24
#define passive 18
#define active 6


using namespace Eigen;
int main(int argc, char const *argv[]) {
  //Testing matrices at this configuration
VectorXd q(24);
q << -0.3387072191053019, -0.2668852440337765, \
0.43779650212078036, 0.19292875565537365, -0.621257056672162, \
-0.48105376820848605, 0.5031287360249618, 0.2942227807536227, \
-0.27361688860670785, -0.2345792804166439, -0.43645468983005425, \
-0.317464082463799, 1.2102085121715935, 1.0832520491273043, \
1.146793858921408, 1.0475951299469117, 1.35699981164951, \
1.1873535959398949, -0.2, 0.1, 1, 0, 0, -0.2;

VectorXd dq(24);
dq << -0.05047659396844983, -0.09400789617397864, -0.08873445615331518, \
-0.025401901264825024, -0.01025884396798242, -0.022545221363188525, \
-0.11343435232032506, -0.11799050155571654, -0.06829694269851751, \
-0.04530673154893169, -0.06088968170507533, -0.13323360193490008, \
0.1, 0, 0, 0, 0, 0, -0.04366523286878406, 0.1062582057014041, -0.017119739450675305, \
0.025430111885699463, 0.023632513813755408, 0.055760677488915625;

VectorXd ab(18);
ab = iksolver(q.tail(6));
std::cout<<ab<<std::endl;

MatrixXd Mtest(24,24);
Mtest << 0.20339, 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., \
0., 0., 0., 0., 0., 0., 0., 0., 0., 0.20339, 0., 0., 0., 0., 0., 0., \
0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., \
0., 0.20339, 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., \
0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 4.506615384615384, 0., 0., \
0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., \
0., 0., 0., 0., 0., 4.506615384615384, 0., 0., 0., 0., 0., 0., 0., \
0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., \
8.665314349112425, 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., \
0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 3.5507408764491757, \
0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., \
0., 0., 0., 0., 0., 0., 0., 3.1905121118231863, 0., 0., 0., 0., 0., \
0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., \
0., 0., 3.716740660074386, 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., \
0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., \
3.0538865907826063, 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., \
0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 5.258509656203682, \
0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., \
0., 0., 0., 0., 0., 0., 0., 3.9651510626601096, 0., 0., 0., 0., 0., \
0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., \
0., 0., 4.625643488793665, 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., \
0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., \
3.483266586816212, 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., \
0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 4.009331098013886, \
0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., \
0., 0., 0., 0., 0., 0., 0., 3.2281743537245724, 0., 0., 0., 0., 0., \
0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., \
0., 0., 6.4021989607002485, 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., \
0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., \
4.393009376739826, 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., \
0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 11.34042298615801, \
0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., \
0., 0., 0., 0., 0., 0., 0., 11.34042298615801, 0., 0., 0., 0., 0., \
0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., \
0., 0., 11.34042298615801, 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., \
0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., \
11.34042298615801, 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., \
0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 11.34042298615801, \
0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., \
0., 0., 0., 0., 0., 0., 0., 11.34042298615801;

MatrixXd Mval(24,24);
Mval = Mmat(q);
std::cout<<"Max val mmat: "<<(Mval-Mtest).maxCoeff()<<std::endl;
std::cout<<"Max val mmat: "<<(Mval-Mtest).minCoeff()<<std::endl;


MatrixXd Ctest(24,24);
Ctest << 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, \
0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, \
0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, \
0, 0, 0, 0, 0, 0, 0.04832537058233153, 0.24155694584927315, \
0.1244159460185391, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, \
0, 0, 0, 0, 0, -0.24155694584927315, 0.04832537058233153, \
-0.08968273695862358, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, \
0, 0, 0, 0, 0, 0., 0., 0.185839922600358, 0, 0, 0, 0, 0, 0, 0, 0, 0, \
0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.62210466264864, 0, 0, \
0, 0, 0, 0.09858318949536264, 0, 0, 0, 0, 0, -0.2021900421231652, 0, \
0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.11399425632260224, 0, 0, 0, 0, 0, \
0.09082392287098386, 0, 0, 0, 0, 0, -0.3253984969421295, 0, 0, 0, 0, \
0, 0, 0, 0, 0, 0, 0, 0, -0.07120116393555324, 0, 0, 0, 0, 0, \
-0.09250775085487828, 0, 0, 0, 0, 0, -0.3701336086263899, 0, 0, 0, 0, \
0, 0, 0, 0, 0, 0, 0, 0, -0.033042283236704446, 0, 0, 0, 0, 0, \
-0.01852565364236566, 0, 0, 0, 0, 0, -0.08109624356135017, 0, 0, 0, \
0, 0, 0, 0, 0, 0, 0, 0, 0, -0.14929335277900682, 0, 0, 0, 0, 0, \
-0.025153312822936372, 0, 0, 0, 0, 0, -0.05799867648362036, 0, 0, 0, \
0, 0, 0, 0, 0, 0, 0, 0, 0, -0.1734906674784041, 0, 0, 0, 0, 0, \
-0.029357350142489688, 0, 0, 0, 0, 0, -0.10092323695903219, 0, 0, 0, \
0, 0, 0, -0.0985831894953627, 0, 0, 0, 0, 0, 0.5218959189856317, 0, \
0, 0, 0, 0, -0.5920092554875598, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, \
-0.09082392287098386, 0, 0, 0, 0, 0, 0., 0, 0, 0, 0, 0, \
-0.4459119686737016, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, \
0.09250775085487828, 0, 0, 0, 0, 0, 0., 0, 0, 0, 0, 0, \
-0.30732327927970265, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, \
0.01852565364236567, 0, 0, 0, 0, 0, 0., 0, 0, 0, 0, 0, \
-0.152903633744733, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, \
0.025153312822936365, 0, 0, 0, 0, 0, 0., 0, 0, 0, 0, 0, \
-0.41914232078025443, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, \
0.029357350142489688, 0, 0, 0, 0, 0, 0., 0, 0, 0, 0, 0, \
-0.66080865772278, 0, 0, 0, 0, 0, 0, 0.20219004212316516, 0, 0, 0, 0, \
0, 0.5920092554875598, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, \
0, 0, 0, 0.3253984969421295, 0, 0, 0, 0, 0, 0.4459119686737016, 0, 0, \
0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.3701336086263899, \
0, 0, 0, 0, 0, 0.30732327927970265, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, \
0, 0, 0, 0, 0, 0, 0, 0.08109624356135017, 0, 0, 0, 0, 0, \
0.152903633744733, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, \
0, 0.05799867648362033, 0, 0, 0, 0, 0, 0.41914232078025443, 0, 0, 0, \
0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.10092323695903214, 0, \
0, 0, 0, 0, 0.66080865772278, 0, 0, 0, 0, 0, 0;

MatrixXd Cval(24,24);
Cval = Cmat(q, dq);
std::cout<<"Max val Cmat: "<<(Cval-Ctest).maxCoeff()<<std::endl;
std::cout<<"Max val Cmat: "<<(Cval-Ctest).minCoeff()<<std::endl;

VectorXd Gtest(24);
Gtest << 0, 0, 1.993222, 0, 0, 0, 15.713453527393655, 10.063365961645765, \
-19.15693092618817, -6.696357133041096, 37.08000367445901, \
22.612999441174647, -24.549138727256835, -11.15321753610035, \
11.486018971305073, 8.191540167921909, 24.163188448954408, \
14.235282844182816, 91.83222903045544, 102.59490887082342, \
96.91030728824727, 106.08692431586665, 81.89842350033658, \
93.59987256060356;

VectorXd Gval(18);
Gval = Gvec(q);
std::cout<<"Max val Gmat: "<<(Gval-Gtest).maxCoeff()<<std::endl;
std::cout<<"Max val Gmat: "<<(Gval-Gtest).minCoeff()<<std::endl;

MatrixXd Jetaqphitest(18, 18);
Jetaqphitest << 0.9999999999999999, 0, 0, 0, 0, 0, 0.19388668106998375, 0, 0, 0, 0, \
0, -0.29109280943777255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, \
-1.060237383390795, 0, 0, 0, 0, 0, -0.48216891175705084, 0, 0, 0, 0, \
0, 0.3522829958135359, 0, 0, 0, 0, 0, -0.5503719548604279, 0, 0, 0, \
0, 0, 0.8263038889105181, 0, 0, 0, 0, 0, 0, 1.0000000000000002, 0, 0, \
0, 0, 0, 0.08284729504749228, 0, 0, 0, 0, 0, -0.2523952597744667, 0, \
0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1.0367023491643677, 0, 0, 0, 0, 0, \
-0.28999611734495384, 0, 0, 0, 0, 0, 0.27340768234070933, 0, 0, 0, 0, \
0, -0.30301743659218544, 0, 0, 0, 0, 0, 0.9231461881891899, 0, 0, 0, \
0, 0, 0, 1.0000000000000002, 0, 0, 0, 0, 0, 0.13137266246973314, 0, \
0, 0, 0, 0, 0.4081740063761322, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, \
-1.1041329629337837, 0, 0, 0, 0, 0, 0.2702155363902797, 0, 0, 0, 0, \
0, -0.46809144388349605, 0, 0, 0, 0, 0, 0.28065597905359424, 0, 0, 0, \
0, 0, 0.8719962983936175, 0, 0, 0, 0, 0, 0, 1., 0, 0, 0, 0, 0, \
0.04668659498150863, 0, 0, 0, 0, 0, 0.18648295853465738, 0, 0, 0, 0, \
0, 0, 0, 0, 0, 0, 0, -1.018903821713252, 0, 0, 0, 0, 0, \
0.23243380908881162, 0, 0, 0, 0, 0, -0.19535863917899896, 0, 0, 0, 0, \
0, 0.23897891169651145, 0, 0, 0, 0, 0, 0.9545672477979888, 0, 0, 0, \
0, 0, 0, 1.0000000000000002, 0, 0, 0, 0, 0, -0.33389361320115984, 0, \
0, 0, 0, 0, -0.5274934026703029, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, \
-1.2297893048519835, 0, 0, 0, 0, 0, 0.4227291696511541, 0, 0, 0, 0, \
0, 0.71580844806996, 0, 0, 0, 0, 0, 0.46645665345448195, 0, 0, 0, 0, \
0, 0.7369197780392053, 0, 0, 0, 0, 0, 0, 1., 0, 0, 0, 0, 0, \
-0.17150126383097966, 0, 0, 0, 0, 0, -0.43959184410025687, 0, 0, 0, \
0, 0, 0, 0, 0, 0, 0, 0, -1.1280216315941844, 0, 0, 0, 0, 0, \
0.3121583689844624, 0, 0, 0, 0, 0, 0.5219509568382896, 0, 0, 0, 0, 0, \
0.32857735307134234, 0, 0, 0, 0, 0, 0.8422090971210746;

MatrixXd Jetaqphival(18, 18);
Jetaqphival = Jetaqphimat(q);
std::cout<<"Max val Jetaqphimat: "<<(Jetaqphival-Jetaqphitest).maxCoeff()<<std::endl;
std::cout<<"Max val Jetaqphimat: "<<(Jetaqphival-Jetaqphitest).minCoeff()<<std::endl;

MatrixXd Jetaqxtest(18, 6);
Jetaqxtest << -1, 0, 0, 0., 0., -0.005461012439474389, 0, -1, 0, 0., 0., \
-1.115948176515639, 0, 0, -1, -0.21772862286365338, \
1.117040379003534, 0., -1, 0, 0, 0., 0., 1.0781407240314318, 0, -1, \
0, 0., 0., -0.28806723956469604, 0, 0, -1, -1.1357541719443711, \
0.07243909475840965, 0., -1, 0, 0, 0., 0., 0.9691699763892014, 0, -1, \
0, 0., 0., 0.5532447127548518, 0, 0, -1, -0.8585210338382311, \
-0.747078708032692, 0., -1, 0, 0, 0., 0., -0.28959681455463154, 0, \
-1, 0, 0., 0., 1.0777308756481159, 0, 0, -1, 0.5051429896842548, \
-1.0198115127371896, 0., -1, 0, 0, 0., 0., -0.9637089639497269, 0, \
-1, 0, 0., 0., 0.5627034637607872, 0, 0, -1, 1.0762496567018844, \
-0.36996167097084176, 0., -1, 0, 0, 0., 0., -0.7885439094768003, 0, \
-1, 0, 0., 0., -0.7896636360834196, 0, 0, -1, 0.6306111822601164, \
0.9473724179787797, 0.;

MatrixXd Jetaqxval(18, 6);
Jetaqxval = Jetaqxmat(q);
std::cout<<"Max val Jetaqxmat: "<<(Jetaqxval-Jetaqxtest).maxCoeff()<<std::endl;
std::cout<<"Max val Jetaqxmat: "<<(Jetaqxval-Jetaqxtest).minCoeff()<<std::endl;


MatrixXd dJetaqphitest(18, 18);
dJetaqphitest << 0.1272794293842467, 0, 0, 0, 0, 0, 0.003840840091147678, 0, 0, 0, 0, \
0, -0.05988224618344566, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, \
-0.1537995988183097, 0, 0, 0, 0, 0, 0.09937737148693801, 0, 0, 0, 0, \
0, 0.10157928500293811, 0, 0, 0, 0, 0, 0.07774364293173935, 0, 0, 0, \
0, 0, 0.036893675795650116, 0, 0, 0, 0, 0, 0, 0.010050698308985955, \
0, 0, 0, 0, 0, -0.0037734778505029917, 0, 0, 0, 0, 0, \
-0.09580696399584661, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, \
-0.03706540499491196, 0, 0, 0, 0, 0, 0.1129201927108638, 0, 0, 0, 0, \
0, 0.1037830900691667, 0, 0, 0, 0, 0, 0.12577880146683618, 0, 0, 0, \
0, 0, 0.009278263832579924, 0, 0, 0, 0, 0, 0, 0.02236789438360242, 0, \
0, 0, 0, 0, 0.007065358853080548, 0, 0, 0, 0, 0, \
-0.08519997434068774, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, \
0.021163960258883577, 0, 0, 0, 0, 0, 0.06575628663721411, 0, 0, 0, 0, \
0, 0.09770680735416223, 0, 0, 0, 0, 0, 0.07995422445618232, 0, 0, 0, \
0, 0, 0.01950472110536069, 0, 0, 0, 0, 0, 0, -0.005864872534434185, \
0, 0, 0, 0, 0, 0.0027805427017573913, 0, 0, 0, 0, 0, \
-0.026266939873976318, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, \
0.011032031756353556, 0, 0, 0, 0, 0, 0.044065880610653696, 0, 0, 0, \
0, 0, 0.027517118290585937, 0, 0, 0, 0, 0, 0.046492659825042845, 0, \
0, 0, 0, 0, -0.005598415233880856, 0, 0, 0, 0, 0, 0, \
-0.0357457643377714, 0, 0, 0, 0, 0, -0.04837065459040059, 0, 0, 0, 0, \
0, 0.007422132101072923, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, \
0.03492896425713814, 0, 0, 0, 0, 0, 0.05518164313208007, 0, 0, 0, 0, \
0, -0.01007183186319374, 0, 0, 0, 0, 0, 0.057464319225338775, 0, 0, \
0, 0, 0, -0.026341760721632235, 0, 0, 0, 0, 0, 0, \
-0.055545044126577646, 0, 0, 0, 0, 0, -0.07694925517285686, 0, 0, 0, \
0, 0, 0.00025646088447599247, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, \
0.04938201690778534, 0, 0, 0, 0, 0, 0.12657592948864405, 0, 0, 0, 0, \
0, -0.0003045097534004962, 0, 0, 0, 0, 0, 0.12936706797776404, 0, 0, \
0, 0, 0, -0.0467805414633952;


MatrixXd dJetaqphival(18, 18);
dJetaqphival = dJetaqphimat(q, dq);
std::cout<<"Max val dJetaqphimat: "<<(dJetaqphival-dJetaqphitest).maxCoeff()<<std::endl;
std::cout<<"Max val dJetaqphimat: "<<(dJetaqphival-dJetaqphitest).minCoeff()<<std::endl;


MatrixXd dJetaqxtest(18, 6);
dJetaqxtest << 0, 0, 0, -0.007894638297003043, 0.03997960458723501, \
0.11954831618144604, 0, 0, 0, -0.013745818047639047, \
-0.036402382736351, -0.024518682743090204, 0, 0, 0, \
-0.06222602636503204, 0.0003045097534004908, -0.02824962953552202, 0, \
0, 0, -0.01502900718474459, -0.024833602604854062, \
0.05401229977031874, 0, 0, 0, 0.059058594863805464, \
0.0031245862363656635, 0.10943325444670154, 0, 0, 0, \
-0.01606282444048921, -0.06011785720038265, -0.03280475768657989, 0, \
0, 0, -0.0077163713801726, -0.05129165643777292, \
-0.038540355967875785, 0, 0, 0, 0.06286319405704485, \
0.029256626420249746, 0.11579122016433162, 0, 0, 0, \
0.030849300000371054, -0.054041574485378226, -0.008834847909367265, \
0, 0, 0, 0.011172695688166936, -0.029008454234791637, \
-0.1217781282548093, 0, 0, 0, -0.003825514967339603, \
0.031735611718189484, -0.007940603505434378, 0, 0, 0, \
0.06009500377686123, 0.016148114578198113, 0.03425071747078634, 0, 0, \
0, 0.015611009677175639, 0.011312051850537908, -0.08100796021357022, \
0, 0, 0, -0.04911737600940579, 0.007145756316101263, \
-0.09127253742124142, 0, 0, 0, 0.031376726364660976, \
0.053737064731977736, 0.03708447744488928, 0, 0, 0, \
0.0038563114965776543, 0.053842056839645686, 0.06776582848449055, 0, \
0, 0, -0.05523307989646585, -0.03486019795455514, \
-0.10149265094126717, 0, 0, 0, -0.044032179336372, \
0.04396974262218454, -0.0014459597842064482;

MatrixXd dJetaqxval(18, 6);
dJetaqxval = dJetaqxmat(q, dq);
std::cout<<"Max val dJetaqxmat: "<<(dJetaqxval-dJetaqxtest).maxCoeff()<<std::endl;
std::cout<<"Max val dJetaqxmat: "<<(dJetaqxval-dJetaqxtest).minCoeff()<<std::endl;


  return 0;
}
